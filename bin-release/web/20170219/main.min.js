var AssetAdapter=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getAsset=function(e,t,i){function n(n){t.call(i,n,e)}if(RES.hasRes(e)){var s=RES.getRes(e);s?n(s):RES.getResAsync(e,n,this)}else RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_IMAGE)},e}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var SoundManager=function(){function e(){this.channel=new Audio}var t=(__define,e),i=t.prototype;return e.Shared=function(){return null==e.shared&&(e.shared=new e),e.shared},i._guess=function(e){this.channel.src="resource/sound/"+e.file_name,this.play()},i._answer=function(e){this.channel.src="resource/sound/"+e.voice,this.play()},i.play=function(){var e=this;this.channel.oncanplay=function(){e.channel.play()}},i.replay=function(){this.channel.pause(),this.channel.currentTime=0,this.play()},i.pause=function(){null!==this.channel&&this.channel.pause()},i.remove=function(){null!==this.channel&&(this.channel.pause(),this.channel.src="")},e}();egret.registerClass(SoundManager,"SoundManager");var LevelIcon=function(e){function t(){e.call(this),this.lb_level=new eui.Label,this.skinName="LevelIconSkin",this.lb_level.textColor=16777215,this.lb_level.horizontalCenter=0,this.lb_level.verticalCenter=0,this.addChild(this.lb_level)}__extends(t,e);var i=__define,n=t,s=n.prototype;return i(s,"Level",function(){return parseInt(this.lb_level.text)},function(e){this.lb_level.text=e.toString()}),t}(eui.Button);egret.registerClass(LevelIcon,"LevelIcon");var LoadingUI=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var i=(__define,t),n=i.prototype;return n.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},n.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.apply(this,arguments),this.isThemeLoadEnd=!1,this.isResourceLoadEnd=!1}__extends(t,e);var i=(__define,t),n=i.prototype;return n.createChildren=function(){e.prototype.createChildren.call(this);var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},n.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t=new eui.Theme("resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},n.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},n.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},n.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},n.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},n.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},n.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},n.startCreateScene=function(){var e=SceneLevels.Shared();this.addChild(e)},t}(eui.UILayer);egret.registerClass(Main,"Main");var SceneBegin=function(e){function t(){e.call(this),this.btn_begin=new eui.Button,this.skinName="SceneBeginSkin";var t='<e:Skin class="btnskin" states="up,down,disabled" minHeight="63" minWidth="200" xmlns:e="http://ns.egret.com/eui">\n                            <e:Image width="100%" height="100%" alpha.disabled="0.5" source="resource/assets/scenebeginbtn.png"/>\n                        </e:Skin>';this.btn_begin.skinName=t,this.btn_begin.x=200,this.btn_begin.y=625,this.addChild(this.btn_begin),this.btn_begin.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onclick_begin,this)}__extends(t,e);var i=(__define,t),n=i.prototype;return t.Shared=function(){return null==t.shared&&(t.shared=new t),t.shared},n.onclick_begin=function(){console.log(this.selLabel)},t}(eui.Component);egret.registerClass(SceneBegin,"SceneBegin");var SceneGame=function(e){function t(){e.call(this),this.aMyanswer=[],this.aRightanswer=[],this.relativelain={sel:[],confuse:[]},this.skinName="resource/skin/SceneGameSkin.exml",SoundManager.Shared()}__extends(t,e);var i=(__define,t),n=i.prototype;return t.Shared=function(){return null==t.shared&&(t.shared=new t),t.shared},n.InitLevel=function(e){this.levelIndex=e,this.levelData=LevelDataManager.Shared().GetLevel(e),this.aMyanswer=[],this.aRightanswer=[],this.list_confuse.visible=!0,this.list_sel.visible=!0,this.backbtn.touchEnabled=!0,this.retrybtn.touchEnabled=!0,this.backbtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.backLevelscene,this),this.retrybtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.retry,this),this.storageRight(),this.selWord(),this.shuffWord(),SoundManager.Shared()._guess(this.levelData)},n.selWord=function(){this.selCollection=new eui.ArrayCollection;for(var e=0;e<this.aRightanswer.length;e++)this.selCollection.addItem({label:""});this.list_sel.dataProvider=this.selCollection,this.addChild(this.list_sel),this.list_sel.itemRenderer=WordlabelRender,this.list_sel.useVirtualLayout=!0,this.gridlayout(this.list_sel,this.aRightanswer.length),this.list_sel.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.selChange,this)},n.selChange=function(){this.selectedIdx=this.list_sel.selectedIndex;var e,t=this.selCollection.getItemAt(this.selectedIdx).label,i=this.relativelain.confuse[this.selectedIdx];""!=t&&(e={label:t},this.selCollection.replaceItemAt({label:""},this.selectedIdx),this.aMyanswer.splice(this.selectedIdx,1,-1),console.log("my点击的answer:"+this.aMyanswer.join("")),this.sourceCollection.replaceItemAt({label:t},i),this.selCollection.addEventListener(eui.CollectionEvent.COLLECTION_CHANGE,this.collectionChangeHandler,this),this.sourceCollection.addEventListener(eui.CollectionEvent.COLLECTION_CHANGE,this.collectionChangeHandler,this))},n.shuffWord=function(){for(var e=[],t=0;24>t;t++)e.push(t);BaseUtil.shuffle(e),this.sourceCollection=new eui.ArrayCollection;for(var t=0;t<e.length;t++)this.sourceCollection.addItem({label:this.levelData.confuse_word.substring(e[t],e[t]+1)});this.list_confuse.dataProvider=this.sourceCollection,this.addChild(this.list_confuse),this.list_confuse.itemRenderer=WordlabelRender,this.list_confuse.useVirtualLayout=!0,this.gridlayout(this.list_confuse,6),this.list_confuse.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.itemChange,this)},n.itemChange=function(){var e,t=BaseUtil.eleIdx(this.aMyanswer,-1);if(e=-1==t?!1:!0){this.selectedIdx=this.list_confuse.selectedIndex;var i=this.sourceCollection.getItemAt(this.selectedIdx).label;this.aMyanswer[t]=i,this.relativelain.sel.push(t),this.relativelain.confuse[t]=this.selectedIdx,this.selCollection.replaceItemAt({label:i},t),this.selCollection.addEventListener(eui.CollectionEvent.COLLECTION_CHANGE,this.collectionChangeHandler,this),this.sourceCollection.replaceItemAt({label:""},this.selectedIdx),this.sourceCollection.addEventListener(eui.CollectionEvent.COLLECTION_CHANGE,this.collectionChangeHandler,this),console.log("my答案长度："+this.aMyanswer.length+";正确答案："+this.aRightanswer.join(""))}},n.collectionChangeHandler=function(){this.checkAnswer()},n.checkAnswer=function(){if(-1!=this.aMyanswer.indexOf(-1)?this.isFull=!1:this.isFull=!0,1==this.isFull){var e=this.aMyanswer.join(""),i=this.aRightanswer.join("");e==i?(console.log("win &&　next"),t.Shared().showWin()):console.log("lose")}},n.storageRight=function(){var e,t=BaseUtil.removeSpace(this.levelData.song_name);this.aRightanswer=[];for(var i=0;i<t.length;i++)e=t[i]," "!=e&&(this.aRightanswer.push(e),this.aMyanswer.push(-1))},n.retry=function(){SoundManager.Shared().replay()},n.showWin=function(){SoundManager.Shared().pause(),SoundManager.Shared()._answer(this.levelData),this.list_confuse.visible=!1,this.list_sel.visible=!1,this.winUI.visible=!0,this.sonename.text=this.levelData.song_name,this.tip.text=this.levelData.tips,this.nextItembtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onclick_next,this),this.mainUIbtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.backLevelscene,this),this.levelIndex+=1,SceneLevels.Shared().OpenLevel(this.levelIndex)},n.onclick_next=function(){SoundManager.Shared().pause(),this.winUI.visible=!1,this.InitLevel(this.levelIndex)},n.backLevelscene=function(){SoundManager.Shared().remove(),this.winUI.visible=!1,this.parent.addChild(SceneLevels.Shared()),this.parent.removeChild(this)},n.gridlayout=function(e,t){var i=new eui.TileLayout;i.horizontalGap=10,i.verticalGap=5,i.columnAlign=eui.ColumnAlign.LEFT,i.rowAlign=eui.RowAlign.TOP,i.requestedColumnCount=t,e.layout=i},t}(eui.Component);egret.registerClass(SceneGame,"SceneGame");var WordlabelRender=function(e){function t(){e.call(this),this.temp_word=SceneGame.Shared().list_confuse,this.skinName="WordlabelSkin",this.addEventListener(eui.UIEvent.COMPLETE,this.onComplete,this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onComplete=function(){this.dataChanged()},n.dataChanged=function(){this.data&&this.wordLabel&&(this.wordLabel.text=this.data.label)},t}(eui.ItemRenderer);egret.registerClass(WordlabelRender,"WordlabelRender");var BaseUtil=function(){function e(){}var t=(__define,e);t.prototype;return e.shuffle=function(e){for(var t,i,n=e.length;n>0;)t=Math.random()*e.length|0,n--,i=e[n],e[n]=e[t],e[t]=i;return e},e.pushonly=function(e,t){-1==e.indexOf(t)&&e.push(t)},e.removeSpace=function(e){var t=e.replace(/[]/g,"");return t},e.removeArrayspace=function(e){for(var t,i,n=0;n<e.length;n++)t=n,i=e[t],""==i&&e.splice(n,1)},e.eleIdx=function(e,t){function i(){e[s]!=t?(s+=1,i()):n=s}var n,s=(e.length,0);return-1==e.indexOf(t)?n=-1:i(),n},e}();egret.registerClass(BaseUtil,"BaseUtil");var LevelDataItem=function(){function e(){}var t=(__define,e);t.prototype;return e}();egret.registerClass(LevelDataItem,"LevelDataItem");var LevelDataManager=function(){function e(){this.items=[],this.items=RES.getRes("levels_json")}var t=__define,i=e,n=i.prototype;return e.Shared=function(){return null==e.shared&&(e.shared=new e),e.shared},n.GetLevel=function(e){return 0>e&&(e=0),e>=this.items.length&&(e=this.items.length-1),this.items.document.Level[e]},t(n,"Milestone",function(){var e=egret.localStorage.getItem("FKCFM_milestone");return(""==e||null==e)&&(e="1"),parseInt(e)},function(e){egret.localStorage.setItem("FKCFM_milestone",e.toString())}),e}();egret.registerClass(LevelDataManager,"LevelDataManager");var SceneLevels=function(e){function t(){e.call(this),this.sel_level=0,this.LevelIcons=[],this.skinName="SceneLevel",this.group_levels=new eui.Group;var t=20,i=801/t,n=new eui.Group;n.width=542,n.height=99*i;for(var s=0;s<=n.height/801;s++){var r=new eui.Image;r.source=RES.getRes("element_png"),r.x=48,r.y=801*s,r.height=797,r.width=455,r.scaleX=1.01,r.scaleY=1.01,r.touchEnabled=!1,this.group_levels.addChild(r)}for(var l=LevelDataManager.Shared().Milestone,s=0;99>s;s++){var a=new LevelIcon;a.Level=s+1,a.y=i*s/2,a.x=400*Math.sin(a.y/180*Math.PI)+n.width/8,a.y+=i*s/2,a.y=n.height-a.y-i,n.addChild(a),a.enabled=l>s,this.LevelIcons.push(a)}n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onclick_level,this),n.cacheAsBitmap=!0,this.img_arrow=new eui.Image,this.img_arrow.source=RES.getRes("dir_png"),this.img_arrow.anchorOffsetX=62-n.getChildAt(0).width/2,this.img_arrow.anchorOffsetY=76,this.img_arrow.touchEnabled=!1,this.img_arrow.x=n.getChildAt(0).x,this.img_arrow.y=n.getChildAt(0).y,this.group_levels.addChild(this.img_arrow),this.group_levels.scrollEnabled=!0,this.group_levels.scrollV=n.height-801,this.group_levels.addChild(n),this.scroller.addChild(this.group_levels),this.scroller.viewport=this.group_levels}__extends(t,e);var i=(__define,t),n=i.prototype;return t.Shared=function(){return null==t.shared&&(t.shared=new t),t.shared},n.onclick_level=function(e){for(var t=0;t<this.LevelIcons.length;t++){var i=this.LevelIcons[t];e.target==i&&(this.sel_level!=i.Level?(this.img_arrow.x=i.x,this.img_arrow.y=i.y,this.sel_level=i.Level):(console.log("icon.Level:"+i.Level),console.log(typeof i.Level),this.parent.addChild(SceneGame.Shared()),SceneGame.Shared().InitLevel(i.Level),this.parent.removeChild(this)))}},n.OpenLevel=function(e){var t=this.LevelIcons[e-1];t.enabled=!0,e>LevelDataManager.Shared().Milestone&&(LevelDataManager.Shared().Milestone=e,this.img_arrow.x=t.x,this.img_arrow.y=t.y,this.sel_level=t.Level)},t}(eui.Component);egret.registerClass(SceneLevels,"SceneLevels");var StartUI=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var i=(__define,t),n=i.prototype;return n.createView=function(){var e=new egret.Bitmap;e.texture=RES.getRes("bg_png"),e.x=0,e.y=0,e.width=542,e.height=801,this.addChild(e)},n.changeScene=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center",this.textField.text="点击这里开始游戏"},t}(egret.Sprite);egret.registerClass(StartUI,"StartUI");var ThemeAdapter=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getTheme=function(e,t,i,n){function s(e){t.call(n,e)}function r(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),i.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(e,s,this,RES.ResourceItem.TYPE_TEXT)},e}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);